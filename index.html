<!DOCTYPE html>
<html lang="en">
<head>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <title>Vodostaj</title>
</head>
<body>
  <script>
  var width = 960;
  var height = 700;
  var centered;

  var projection = d3.geo.mercator()
    .center([0, 10])
    .scale(6000)
    .translate([17600, 4500])
    .rotate([-180, 0]);

  var path = d3.geo.path()
    .projection(projection);

  var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
    .style("background", "white");

  var g = svg.append("g");

  d3.json("cro_regv3.json", function(error, cro) {
    var data = topojson.feature(cro, cro.objects.layer1);

    var counties = g.selectAll("path.county")
      .data(data.features)
      .enter()
      .append("path")
      .attr("class", "county")
      .attr("id", function(d) { return d.id; })
      .attr("d", path)
      .style("fill", "white")
      .style("stroke", "gray")
      .style("stroke-width", 1)
      .style("stroke-opacity", 1);

    d3.json("rivers.geojson", function(error, rivers) {
      var riversData = rivers.features;

      var riversPath = g.selectAll(".river")
        .data(riversData)
        .enter()
        .append("path")
        .attr("class", "river")
        .attr("d", path)
        .style("fill", "none")
        .style("stroke", "blue")
        .style("stroke-width", 1);

      riversPath.on("click", function(d) {
        var bounds = path.bounds(d.geometry);
        var dx = bounds[1][0] - bounds[0][0];
        var dy = bounds[1][1] - bounds[0][1];
        var x = (bounds[0][0] + bounds[1][0]) / 2;
        var y = (bounds[0][1] + bounds[1][1]) / 2;
        var scale = 0.9 / Math.max(dx / width, dy / height);
        var translate = [width / 2 - scale * x, height / 2 - scale * y];
        
        g.transition()
          .duration(750)
          .attr("transform", "translate(" + translate + ")scale(" + scale + ")");
      });
    });
  });
  </script>
</body>
</html>
